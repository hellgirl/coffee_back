<!DOCTYPE html>
<html>
  <head>
    <title>CoffeeBack</title>
    <link rel="manifest" href="/manifest.json">
    <%= csrf_meta_tags %>

    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
  </head>

  <body>
    <%= yield %>
  </body>


  <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyDNSBMp3qGRcHozMiKk_IhhXQzyXEwKGyo",
      authDomain: "nicecoffee-57e78.firebaseapp.com",
      databaseURL: "https://nicecoffee-57e78.firebaseio.com",
      projectId: "nicecoffee-57e78",
      storageBucket: "",
      messagingSenderId: "978135584480"
    };
    firebase.initializeApp(config);
    const messaging = firebase.messaging();
    messaging.usePublicVapidKey("BPC85ILQOaKObrR6_mXbEAiPWAFB-tWPj5LJfeIx6IDtcwbk2MfjRaZrJmux71fyKGO4VaSYhroXzsvErQpzjU0");
    messaging.requestPermission().then(function() {
      console.log('Notification permission granted.');
      messaging.getToken().then(function(currentToken) {
        if (currentToken) {
          sendTokenToServer(currentToken);
          updateUIForPushEnabled(currentToken);
        } else {
          // Show permission request.
          console.log('No Instance ID token available. Request permission to generate one.');
          // Show permission UI.
          updateUIForPushPermissionRequired();
          setTokenSentToServer(false);
        }
      }).catch(function(err) {
        console.log('An error occurred while retrieving token. ', err);
        showToken('Error retrieving Instance ID token. ', err);
        setTokenSentToServer(false);
      });
    }).catch(function(err) {
      console.log('Unable to get permission to notify.', err);
    });
  </script>
</html>
